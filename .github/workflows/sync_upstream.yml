# 工作流程名稱
name: Sync with Upstream

# 觸發條件
on:
  schedule:
    - cron: '0 * * * *'  # 每小時執行一次
  workflow_dispatch:      # 允許手動觸發

# 工作任務
jobs:
  sync:
    # 運行環境
    runs-on: ubuntu-latest

    # 任務步驟
    steps:
      # 步驟 1: 檢出您的 fork 倉庫代碼
      - name: Checkout Fork
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.ACTION_PAT }}
          fetch-depth: 0

      # 步驟 2: 設置上游（原始）倉庫的遠程地址
      - name: Set up remote for upstream repository
        run: |
          git remote add upstream https://github.com/Darwin-lfl/langmanus.git

      # 步驟 3: [已修改] 使用强制方式同步分支
      - name: Force sync main branch with upstream
        run: |
          # 配置 git 用戶信息
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          
          # 從上游倉庫獲取最新內容
          git fetch upstream
          
          # 檢出本地的 main 分支
          git checkout main
          
          # 【关键修改】使用 'reset' 强制本地 main 分支与上游保持一致
          # 这会丢弃您 fork 的 main 分支上的所有本地提交，使其成为上游的精确副本
          git reset --hard upstream/main
          
          # 【关键修改】使用 'force push' 将重置后的分支推送到您的 fork
          # 因为历史记录已被改变，必须使用强制推送
          git push --force origin main
